





<!DOCTYPE html>



<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" prefix="og: http://ogp.me/ns#"> <!--<![endif]-->



<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width" />

	<title>authomatic.providers.oauth2 | Authomatic</title>
    	<link rel="icon" type="image/x-icon" href="../../../_static/img/favicon.ico" />
	
	
	
	<meta property="og:title" content="authomatic.providers.oauth2 | Authomatic" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="http://peterhudec.github.io/authomatic/_modules/authomatic/providers/oauth2.html" />
	<meta property="og:image" content="http://peterhudec.github.io/authomatic/_static/img/authomatic-seo.gif" />
	
	
	<meta property="og:description" content="Simple yet powerful authorization / authentication client library for Python WEB applications." />
	<meta property="og:site_name" content="Authomatic" />
	
	
    
    
	<meta name="description" content="Simple yet powerful authorization / authentication client library for Python WEB applications.">
    
	
	
	
    <link rel="stylesheet" href="../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <link rel="stylesheet" href="../../../_static/css/authomatic.css" type="text/css" />
    	
	<script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    	<script type="text/javascript" src="../../../_static/jquery.js"></script>
    	<script type="text/javascript" src="../../../_static/underscore.js"></script>
    	<script type="text/javascript" src="../../../_static/doctools.js"></script>
    	<script type="text/javascript" src="../../../_static/foundation/js/vendor/custom.modernizr.js"></script>
 
<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var s = document.createElement('script');
    var t = document.getElementsByTagName('script')[0];

    s.type = 'text/javascript';
    s.async = true;
    s.src = '//api.flattr.com/js/0.6/load.js?mode=auto';

    t.parentNode.insertBefore(s, t);
 })();
/* ]]> */
</script>

</head>



<body>
	<div id="fb-root"></div>
		<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=249464911861131";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));</script><div id="root"><div class="contain-to-grid">
			<nav class="top-bar">
				<ul class="title-area">
					<li class="name">
					  <h1><a href="../../../index.html">Authomatic</a></h1>
					</li>
					<li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li>
				</ul>
				 
				<section class="top-bar-section">
					<ul class="left"><li class="divider"></li></ul>
					
						<ul class="">
<li class="has-dropdown toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a><ul class="dropdown ">
<li class="toctree-l2"><a class="reference internal" href="../../../reference/config.html">Config</a></li>
<li class="has-dropdown toctree-l2"><a class="reference internal" href="../../../reference/adapters.html">Adapters</a><ul class="dropdown ">
<li class="toctree-l3"><a class="reference internal" href="../../../reference/adapters.html#available-adapters">Available Adapters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/adapters.html#implementing-an-adapter">Implementing an Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/classes.html">Classes</a></li>
<li class="has-dropdown toctree-l2"><a class="reference internal" href="../../../reference/providers.html">Providers</a><ul class="dropdown ">
<li class="toctree-l3"><a class="reference internal" href="../../../reference/providers.html#oauth2-providers">OAuth 2.0 Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/providers.html#oauth1-providers">OAuth 1.0a Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/providers.html#openid-providers">OpenID Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/providers.html#google-app-engine-openid-providers">Google App Engine OpenID Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/providers.html#abstract-classes-for-providers">Abstract Classes for Providers</a></li>
</ul>
</li>
<li class="has-dropdown toctree-l2"><a class="reference internal" href="../../../reference/extras.html">Extras</a><ul class="dropdown ">
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extras.html#flask-extras">Flask Extras</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extras.html#gae-extras">Google App Engine Extras</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extras.html#interfaces">Interfaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/javascript.html">JavaScript</a></li>
</ul>
</li>
<li class="has-dropdown toctree-l1"><a class="reference internal" href="../../../examples/index.html">Tutorials / Examples</a><ul class="dropdown ">
<li class="toctree-l2"><a class="reference internal" href="../../../examples/django-simple.html">Simple Django Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/flask-simple.html">Simple Flask Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/pyramid-simple.html">Simple Pyramid Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/simple.html">Simple Webapp2 Google App Engine Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/credentials.html">Advanced Webapp2 Google App Engine Example</a></li>
</ul>
</li>
<li class="has-dropdown toctree-l1"><a class="reference internal" href="../../../development.html">Development</a><ul class="dropdown ">
<li class="toctree-l2"><a class="reference internal" href="../../../development.html#development-environment-setup">Development Environment Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development.html#documentation-compilation-and-deployment">Documentation Compilation and Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development.html#tests">Tests</a></li>
</ul>
</li>
<li class="has-dropdown toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a><ul class="dropdown ">
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-0-0-9-development">Version 0.0.9 (development)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-0-0-8">Version 0.0.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-0-0-7">Version 0.0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-0-0-6">Version 0.0.6</a></li>
</ul>
</li>
</ul>

					
					<ul class="left">
						
	<li class="divider"></li>

	
		
			<li><a href="../../../genindex.html"  title="General Index">index</a></li>
		
		
			<li><a href="../../../py-modindex.html"  title="Python Module Index">modules</a></li>
		

	
					</ul>
				</section>
			</nav>
		</div><div id="header">
			<div class="row">
				
		        <div id="logo-container" class="large-6 columns">
		        	
	<div>
		<a href="../../../index.html">
		
	    	
	    		<img id="logo" src="../../../_static/img/authomatic.svg" />
	    	
		
		</a>
	</div>

		        </div>
		        <div class="large-6 columns">
		            <p id="motto">
						<span>Authomatic</span><br />
is an <em>authorization</em> / <em>authentication</em><br />
client library for Python web applications<br />
inspired by Alex Vaginâ€™s
<a href="http://code.google.com/p/gae-simpleauth/" target="_blank">Simpleauth</a>.<br /> 
In fact, I almost named it <em>Deadsimpleauth</em>,<br /> 
but that name would be too long<br />
for a succinct library.
					</p>
		        </div>
		        
		    </div>
	    </div>
	    
	    <div class="social-buttons">
	    	<ul>
	    		<li>
	    			<div class="fb-like" data-href="http://peterhudec.github.io/authomatic/_modules/authomatic/providers/oauth2.html" data-send="false" data-layout="button_count" data-width="100" data-show-faces="false" data-font="arial"></div>
	    		</li>
	    		<li>
	    			<div class="g-plusone" data-size="medium" data-href="http://peterhudec.github.io/authomatic/_modules/authomatic/providers/oauth2.html"></div>
	    		</li>
	    		<li>
	    			<a href="https://twitter.com/share" class="twitter-share-button" data-via="AuthomaticPy">Tweet</a>
					<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
	    		</li>
	    		
	    		<li>
	    			<iframe src="http://ghbtns.com/github-btn.html?user=peterhudec&repo=authomatic&type=watch&count=true"
  							allowtransparency="true" frameborder="0" scrolling="0" width="100" height="20"></iframe>
	    		</li>
	    		
	    		<li>
	    			<script src="//platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
					<script type="IN/Share" data-counter="right"></script>
	    		</li>
	    		
	    		<li>
	    			<a	class="FlattrButton"
	    				href="http://peterhudec.github.io/foundation-sphinx-theme/cards/html"
	    				data-flattr-uid="peterhudec"
	    				data-flattr-category="software"
	    				data-flattr-button="compact"
	    				data-flattr-tags=""
	    				data-flattr-description="Simple yet powerful authorization / authentication client library for Python WEB applications."
	    				title="authomatic.providers.oauth2 | Authomatic"></a>
	    		</li>
	    		
	    		<li class="reddit">
	    			<script type="text/javascript" src="http://www.reddit.com/static/button/button1.js">
	    				reddit_newwindow='1';
	    			</script>
	    		</li>
	    	</ul>
	    	
	    </div>
		
		
		
		<div class="row">
	</div>
		
		
		<div class="row">
			
			<div id="content" class="large-9 push-3 columns">
				
  <h1>Source code for authomatic.providers.oauth2</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">|oauth2| Providers</span>
<span class="sd">-------------------</span>

<span class="sd">Providers which implement the |oauth2|_ protocol.</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    </span>
<span class="sd">    OAuth2</span>
<span class="sd">    Behance</span>
<span class="sd">    Bitly</span>
<span class="sd">    Cosm</span>
<span class="sd">    DeviantART</span>
<span class="sd">    Facebook</span>
<span class="sd">    Foursquare</span>
<span class="sd">    GitHub</span>
<span class="sd">    Google</span>
<span class="sd">    LinkedIn</span>
<span class="sd">    PayPal</span>
<span class="sd">    Reddit</span>
<span class="sd">    Viadeo</span>
<span class="sd">    VK</span>
<span class="sd">    WindowsLive</span>
<span class="sd">    Yammer</span>
<span class="sd">    Yandex</span>
<span class="sd">    </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlencode</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">authomatic</span> <span class="kn">import</span> <span class="n">providers</span>
<span class="kn">from</span> <span class="nn">authomatic.exceptions</span> <span class="kn">import</span> <span class="n">CancellationError</span><span class="p">,</span> <span class="n">FailureError</span><span class="p">,</span> <span class="n">OAuth2Error</span>
<span class="kn">import</span> <span class="nn">authomatic.core</span> <span class="kn">as</span> <span class="nn">core</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;OAuth2&#39;</span><span class="p">,</span> <span class="s">&#39;Behance&#39;</span><span class="p">,</span> <span class="s">&#39;Bitly&#39;</span><span class="p">,</span> <span class="s">&#39;Cosm&#39;</span><span class="p">,</span> <span class="s">&#39;DeviantART&#39;</span><span class="p">,</span> <span class="s">&#39;Facebook&#39;</span><span class="p">,</span> <span class="s">&#39;Foursquare&#39;</span><span class="p">,</span> <span class="s">&#39;GitHub&#39;</span><span class="p">,</span>
           <span class="s">&#39;Google&#39;</span><span class="p">,</span> <span class="s">&#39;LinkedIn&#39;</span><span class="p">,</span> <span class="s">&#39;PayPal&#39;</span><span class="p">,</span> <span class="s">&#39;Reddit&#39;</span><span class="p">,</span> <span class="s">&#39;Viadeo&#39;</span><span class="p">,</span> <span class="s">&#39;VK&#39;</span><span class="p">,</span> <span class="s">&#39;WindowsLive&#39;</span><span class="p">,</span> <span class="s">&#39;Yammer&#39;</span><span class="p">,</span> <span class="s">&#39;Yandex&#39;</span><span class="p">]</span>


<div class="viewcode-block" id="OAuth2"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.OAuth2">[docs]</a><span class="k">class</span> <span class="nc">OAuth2</span><span class="p">(</span><span class="n">providers</span><span class="o">.</span><span class="n">AuthorizationProvider</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for |oauth2|_ providers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">PROVIDER_TYPE_ID</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">TOKEN_TYPES</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;Bearer&#39;</span><span class="p">]</span>
    
    <span class="c">#: A scope preset to get most of the **user** info.</span>
    <span class="c">#: Use it in the :doc:`config` like ``{&#39;scope&#39;: oauth2.Facebook.user_info_scope}``.</span>
    <span class="n">user_info_scope</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c">#: :class:`bool` If ``False``, the provider doesn&#39;t support CSRF protection.</span>
    <span class="n">supports_csrf_protection</span> <span class="o">=</span> <span class="bp">True</span>
    
    <span class="n">token_request_method</span> <span class="o">=</span> <span class="s">&#39;POST&#39;</span>  <span class="c"># method for requesting an access token</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Accepts additional keyword arguments:</span>
<span class="sd">        </span>
<span class="sd">        :param list scope:</span>
<span class="sd">            List of strings specifying requested permissions as described in the</span>
<span class="sd">            `OAuth 2.0 spec &lt;http://tools.ietf.org/html/rfc6749#section-3.3&gt;`_.</span>
<span class="sd">        </span>
<span class="sd">        :param bool offline:</span>
<span class="sd">            If ``True`` the **provider** will be set up to request an *offline access token*.</span>
<span class="sd">            default is ``False``.</span>
<span class="sd">        </span>
<span class="sd">        As well as those inherited from :class:`.AuthorizationProvider` constructor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="nb">super</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scope</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwarg</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s">&#39;scope&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwarg</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="s">&#39;offline&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
    
    
    <span class="c">#===========================================================================</span>
    <span class="c"># Internal methods</span>
    <span class="c">#===========================================================================</span>
    
    <span class="k">def</span> <span class="nf">_x_scope_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override this to handle differences between accepted format of scope across providers.</span>
<span class="sd">        </span>
<span class="sd">        :attr list scope:</span>
<span class="sd">            List of scopes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Most providers accept csv scope.</span>
        <span class="k">return</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span> <span class="k">if</span> <span class="n">scope</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="OAuth2.create_request_elements"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.OAuth2.create_request_elements">[docs]</a>    <span class="k">def</span> <span class="nf">create_request_elements</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">headers</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">secret</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">redirect_uri</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">csrf</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates |oauth2| request elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">headers</span> <span class="o">=</span> <span class="n">headers</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">params</span> <span class="ow">or</span> <span class="p">{}</span>
        
        <span class="n">consumer_key</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">consumer_key</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
        <span class="n">consumer_secret</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">consumer_secret</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">token</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
        <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">refresh_token</span> <span class="ow">or</span> <span class="n">credentials</span><span class="o">.</span><span class="n">token</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span>
        
        <span class="c"># Separate url base and query parameters.</span>
        <span class="n">url</span><span class="p">,</span> <span class="n">base_params</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">_split_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
                
        <span class="c"># Add params extracted from URL.</span>
        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">base_params</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">cls</span><span class="o">.</span><span class="n">USER_AUTHORIZATION_REQUEST_TYPE</span><span class="p">:</span>
            <span class="c"># User authorization request.</span>
            <span class="c"># TODO: Raise error for specific message for each missing argument.</span>
            <span class="k">if</span> <span class="n">consumer_key</span> <span class="ow">and</span> <span class="n">redirect_uri</span> <span class="ow">and</span> <span class="p">(</span><span class="n">csrf</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">cls</span><span class="o">.</span><span class="n">supports_csrf_protection</span><span class="p">):</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;client_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">consumer_key</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;redirect_uri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">redirect_uri</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;scope&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scope</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;state&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">csrf</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;response_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;code&#39;</span>
                
                <span class="c"># Add authorization header</span>
                <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">_authorization_header</span><span class="p">(</span><span class="n">credentials</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OAuth2Error</span><span class="p">(</span><span class="s">&#39;Credentials with valid consumer_key and arguments redirect_uri, scope and &#39;</span> <span class="o">+</span> \
                                  <span class="s">&#39;state are required to create OAuth 2.0 user authorization request elements!&#39;</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">cls</span><span class="o">.</span><span class="n">ACCESS_TOKEN_REQUEST_TYPE</span><span class="p">:</span>
            <span class="c"># Access token request.</span>
            <span class="k">if</span> <span class="n">consumer_key</span> <span class="ow">and</span> <span class="n">consumer_secret</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;client_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">consumer_key</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;client_secret&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">consumer_secret</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;redirect_uri&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">redirect_uri</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;grant_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;authorization_code&#39;</span>
                
                <span class="c"># TODO: Check whether all providers accept it</span>
                <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cls</span><span class="o">.</span><span class="n">_authorization_header</span><span class="p">(</span><span class="n">credentials</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OAuth2Error</span><span class="p">(</span><span class="s">&#39;Credentials with valid token, consumer_key, consumer_secret and argument &#39;</span> <span class="o">+</span> \
                                  <span class="s">&#39;redirect_uri are required to create OAuth 2.0 access token request elements!&#39;</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">cls</span><span class="o">.</span><span class="n">REFRESH_TOKEN_REQUEST_TYPE</span><span class="p">:</span>
            <span class="c"># Refresh access token request.</span>
            <span class="k">if</span> <span class="n">refresh_token</span> <span class="ow">and</span> <span class="n">consumer_key</span> <span class="ow">and</span> <span class="n">consumer_secret</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;refresh_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">refresh_token</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;client_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">consumer_key</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;client_secret&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">consumer_secret</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;grant_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;refresh_token&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OAuth2Error</span><span class="p">(</span><span class="s">&#39;Credentials with valid refresh_token, consumer_key, consumer_secret &#39;</span> <span class="o">+</span> \
                                  <span class="s">&#39;are required to create OAuth 2.0 refresh token request elements!&#39;</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">cls</span><span class="o">.</span><span class="n">PROTECTED_RESOURCE_REQUEST_TYPE</span><span class="p">:</span>
            <span class="c"># Protected resource request.</span>
            
            <span class="c"># Add Authorization header. See: http://tools.ietf.org/html/rfc6749#section-7.1</span>
            <span class="k">if</span> <span class="n">credentials</span><span class="o">.</span><span class="n">token_type</span> <span class="o">==</span> <span class="n">cls</span><span class="o">.</span><span class="n">BEARER</span><span class="p">:</span>
                <span class="c"># http://tools.ietf.org/html/rfc6750#section-2.1</span>
                <span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;Authorization&#39;</span><span class="p">:</span> <span class="s">&#39;Bearer {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">credentials</span><span class="o">.</span><span class="n">token</span><span class="p">)})</span>
                
            <span class="k">elif</span> <span class="n">token</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;access_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OAuth2Error</span><span class="p">(</span><span class="s">&#39;Credentials with valid token are required to create &#39;</span> <span class="o">+</span> \
                                  <span class="s">&#39;OAuth 2.0 protected resources request elements!&#39;</span><span class="p">)</span>
        
        <span class="n">request_elements</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">RequestElements</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_x_request_elements_filter</span><span class="p">(</span><span class="n">request_type</span><span class="p">,</span> <span class="n">request_elements</span><span class="p">,</span> <span class="n">credentials</span><span class="p">)</span>
    
    </div>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_refresh_credentials_if</span><span class="p">(</span><span class="n">credentials</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override this to specify conditions when it gives sense to refresh credentials.</span>
<span class="sd">        </span>
<span class="sd">        .. warning::</span>

<span class="sd">            |classmethod|</span>
<span class="sd">        </span>
<span class="sd">        :param credentials:</span>
<span class="sd">            :class:`.Credentials`</span>
<span class="sd">        </span>
<span class="sd">        :returns:</span>
<span class="sd">            ``True`` or ``False``</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">credentials</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
    
    
    <span class="c">#===========================================================================</span>
    <span class="c"># Exposed methods</span>
    <span class="c">#===========================================================================</span>
    
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">to_tuple</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">credentials</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">credentials</span><span class="o">.</span><span class="n">token</span><span class="p">,</span>
                <span class="n">credentials</span><span class="o">.</span><span class="n">refresh_token</span><span class="p">,</span>
                <span class="n">credentials</span><span class="o">.</span><span class="n">expiration_time</span><span class="p">,</span>
                <span class="n">cls</span><span class="o">.</span><span class="n">TOKEN_TYPES</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">credentials</span><span class="o">.</span><span class="n">token_type</span><span class="p">))</span>
    
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">reconstruct</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">deserialized_tuple</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">cfg</span><span class="p">):</span>
        
        <span class="n">token</span><span class="p">,</span> <span class="n">refresh_token</span><span class="p">,</span> <span class="n">expiration_time</span><span class="p">,</span> <span class="n">token_type</span> <span class="o">=</span> <span class="n">deserialized_tuple</span>
        
        <span class="n">credentials</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="n">credentials</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="n">refresh_token</span>
        <span class="n">credentials</span><span class="o">.</span><span class="n">expiration_time</span> <span class="o">=</span> <span class="n">expiration_time</span>
        <span class="n">credentials</span><span class="o">.</span><span class="n">token_type</span><span class="o">=</span><span class="n">cls</span><span class="o">.</span><span class="n">TOKEN_TYPES</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">token_type</span><span class="p">)]</span>
        
        <span class="k">return</span> <span class="n">credentials</span>
    
    
<div class="viewcode-block" id="OAuth2.refresh_credentials"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.OAuth2.refresh_credentials">[docs]</a>    <span class="k">def</span> <span class="nf">refresh_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Refreshes :class:`.Credentials` if it gives sense.</span>
<span class="sd">        </span>
<span class="sd">        :param credentials:</span>
<span class="sd">            :class:`.Credentials` to be refreshed.</span>
<span class="sd">        </span>
<span class="sd">        :returns:</span>
<span class="sd">            :class:`.Response`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_refresh_credentials_if</span><span class="p">(</span><span class="n">credentials</span><span class="p">):</span>
            <span class="k">return</span>
        
        <span class="c"># We need consumer key and secret to make this kind of request.</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">credentials</span><span class="o">.</span><span class="n">provider_name</span><span class="p">)</span>
        <span class="n">credentials</span><span class="o">.</span><span class="n">consumer_key</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;consumer_key&#39;</span><span class="p">)</span>
        <span class="n">credentials</span><span class="o">.</span><span class="n">consumer_secret</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;consumer_secret&#39;</span><span class="p">)</span>
        
        <span class="n">request_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_request_elements</span><span class="p">(</span><span class="n">request_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">REFRESH_TOKEN_REQUEST_TYPE</span><span class="p">,</span>
                                                        <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
                                                        <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token_url</span><span class="p">,</span>
                                                        <span class="n">method</span><span class="o">=</span><span class="s">&#39;POST&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s">&#39;Refreshing credentials.&#39;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch</span><span class="p">(</span><span class="o">*</span><span class="n">request_elements</span><span class="p">)</span>
        
        <span class="c"># We no longer need consumer info.</span>
        <span class="n">credentials</span><span class="o">.</span><span class="n">consumer_key</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">credentials</span><span class="o">.</span><span class="n">consumer_secret</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="c"># Extract the refreshed data.</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;access_token&#39;</span><span class="p">)</span>
        <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;refresh_token&#39;</span><span class="p">)</span>
        
        <span class="c"># Update credentials only if there is access token.</span>
        <span class="k">if</span> <span class="n">access_token</span><span class="p">:</span>
            <span class="n">credentials</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">access_token</span>
            <span class="n">credentials</span><span class="o">.</span><span class="n">expire_in</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;expires_in&#39;</span><span class="p">)</span>
            
            <span class="c"># Update refresh token only if there is a new one.</span>
            <span class="k">if</span> <span class="n">refresh_token</span><span class="p">:</span>
                <span class="n">credentials</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="n">refresh_token</span>
            
            <span class="c"># Handle different naming conventions across providers.</span>
            <span class="n">credentials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_credentials_parser</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">response</span>
    
    </div>
    <span class="nd">@providers.login_decorator</span>
    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c"># get request parameters from which we can determine the login phase</span>
        <span class="n">authorization_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;code&#39;</span><span class="p">)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;error_message&#39;</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;state&#39;</span><span class="p">)</span>      
        
        <span class="k">if</span> <span class="n">authorization_code</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_url</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="n">authorization_code</span><span class="p">:</span>
                <span class="c">#===================================================================</span>
                <span class="c"># Phase 2 after redirect with success</span>
                <span class="c">#===================================================================</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s">&#39;Continuing OAuth 2.0 authorization procedure after redirect.&#39;</span><span class="p">)</span>
                
                <span class="c"># validate CSRF token</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">supports_csrf_protection</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s">&#39;Validating request by comparing request state with stored state.&#39;</span><span class="p">)</span>
                    <span class="n">stored_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_get</span><span class="p">(</span><span class="s">&#39;state&#39;</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">stored_state</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">FailureError</span><span class="p">(</span><span class="s">&#39;Unable to retrieve stored state!&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">stored_state</span> <span class="o">==</span> <span class="n">state</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">FailureError</span><span class="p">(</span><span class="s">&#39;The returned state &quot;{0}&quot; doesn</span><span class="se">\&#39;</span><span class="s">t match with the stored state!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state</span><span class="p">),</span>
                                           <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_url</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s">&#39;Request is valid.&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARN</span><span class="p">,</span> <span class="s">&#39;Skipping CSRF validation!&#39;</span><span class="p">)</span>
            
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_url</span><span class="p">:</span>
                <span class="c">#===================================================================</span>
                <span class="c"># Phase 1 without user authorization redirect.</span>
                <span class="c">#===================================================================</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s">&#39;Starting OAuth 2.0 authorization procedure without &#39;</span> <span class="o">+</span> \
                                        <span class="s">&#39;user authorization redirect.&#39;</span><span class="p">)</span>
            
            <span class="c"># exchange authorization code for access token by the provider</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s">&#39;Fetching access token from {0}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token_url</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">authorization_code</span>
            
            <span class="n">request_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_request_elements</span><span class="p">(</span><span class="n">request_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ACCESS_TOKEN_REQUEST_TYPE</span><span class="p">,</span>
                                                             <span class="n">credentials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">,</span>
                                                             <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token_url</span><span class="p">,</span>
                                                             <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">token_request_method</span><span class="p">,</span>
                                                             <span class="n">redirect_uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                                                             <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token_params</span><span class="p">,</span>
                                                             <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token_headers</span><span class="p">)</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fetch</span><span class="p">(</span><span class="o">*</span><span class="n">request_elements</span><span class="p">)</span>
            
            <span class="n">access_token</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;access_token&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;refresh_token&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">200</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">access_token</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FailureError</span><span class="p">(</span><span class="s">&#39;Failed to obtain OAuth 2.0 access token from {0}! HTTP status: {1}, message: {2}.&#39;</span>\
                                  <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token_url</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">),</span>
                                  <span class="n">original_message</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span>
                                  <span class="n">status</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                                  <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">access_token_url</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s">&#39;Got access token.&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">refresh_token</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s">&#39;Got refresh access token.&#39;</span><span class="p">)</span>
            
            <span class="c"># OAuth 2.0 credentials need access_token, refresh_token, token_type and expire_in.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">access_token</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">refresh_token</span> <span class="o">=</span> <span class="n">refresh_token</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">expire_in</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;expires_in&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">token_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;token_type&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="c"># sWe don&#39;t need these two guys anymore.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">consumer_key</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">consumer_secret</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            
            <span class="c"># update credentials</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x_credentials_parser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>            
            
            <span class="c"># create user</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_or_create_user</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">)</span>
            
            <span class="c">#===================================================================</span>
            <span class="c"># We&#39;re done!</span>
            <span class="c">#===================================================================</span>
            
        <span class="k">elif</span> <span class="n">error</span> <span class="ow">or</span> <span class="n">error_message</span><span class="p">:</span>
            <span class="c">#===================================================================</span>
            <span class="c"># Phase 2 after redirect with error</span>
            <span class="c">#===================================================================</span>
            
            <span class="n">error_reason</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;error_reason&#39;</span><span class="p">)</span>
            <span class="n">error_description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;error_description&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">error_message</span>
            
            <span class="k">if</span> <span class="n">error_reason</span> <span class="o">==</span> <span class="s">&#39;user_denied&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">CancellationError</span><span class="p">(</span><span class="n">error_description</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_url</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FailureError</span><span class="p">(</span><span class="n">error_description</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_url</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="c">#===================================================================</span>
            <span class="c"># Phase 1 before redirect</span>
            <span class="c">#===================================================================</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s">&#39;Starting OAuth 2.0 authorization procedure.&#39;</span><span class="p">)</span>
            
            <span class="n">csrf</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">supports_csrf_protection</span><span class="p">:</span>
                <span class="c"># generate csfr</span>
                <span class="n">csrf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">csrf_generator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
                <span class="c"># and store it to session</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_session_set</span><span class="p">(</span><span class="s">&#39;state&#39;</span><span class="p">,</span> <span class="n">csrf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARN</span><span class="p">,</span> <span class="s">&#39;Provider doesn</span><span class="se">\&#39;</span><span class="s">t support CSRF validation!&#39;</span><span class="p">)</span>
                        
            <span class="n">request_elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_request_elements</span><span class="p">(</span><span class="n">request_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">USER_AUTHORIZATION_REQUEST_TYPE</span><span class="p">,</span>
                                                            <span class="n">credentials</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="p">,</span>
                                                            <span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_url</span><span class="p">,</span>
                                                            <span class="n">redirect_uri</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
                                                            <span class="n">scope</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_x_scope_parser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">),</span>
                                                            <span class="n">csrf</span><span class="o">=</span><span class="n">csrf</span><span class="p">,</span>
                                                            <span class="n">params</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_params</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s">&#39;Redirecting user to {0}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">request_elements</span><span class="o">.</span><span class="n">full_url</span><span class="p">))</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="n">request_elements</span><span class="o">.</span><span class="n">full_url</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="Behance"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.Behance">[docs]</a><span class="k">class</span> <span class="nc">Behance</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Behance |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: http://www.behance.net/dev/apps</span>
<span class="sd">    * Docs: http://www.behance.net/dev/authentication</span>
<span class="sd">    * API reference: http://www.behance.net/dev/api/endpoints/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://www.behance.net/v2/oauth/authenticate&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://www.behance.net/v2/oauth/token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    
    <span class="n">user_info_scope</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;activity_read&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">_x_scope_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Behance has pipe-separated scopes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        
        <span class="n">_user</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="p">{})</span>
        
        <span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;first_name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;last_name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;country&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;url&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;display_name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;images&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;138&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">user</span>

</div>
<div class="viewcode-block" id="Bitly"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.Bitly">[docs]</a><span class="k">class</span> <span class="nc">Bitly</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bitly |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    .. warning::</span>

<span class="sd">        |no-csrf|</span>

<span class="sd">    * Dashboard: https://bitly.com/a/oauth_apps</span>
<span class="sd">    * Docs: http://dev.bitly.com/authentication.html</span>
<span class="sd">    * API reference: http://dev.bitly.com/api.html</span>

<span class="sd">    Supported :class:`.User` properties:</span>

<span class="sd">    * id</span>
<span class="sd">    * link</span>
<span class="sd">    * name</span>
<span class="sd">    * picture</span>
<span class="sd">    * username</span>

<span class="sd">    Unsupported :class:`.User` properties:</span>

<span class="sd">    * birth_date</span>
<span class="sd">    * city</span>
<span class="sd">    * country</span>
<span class="sd">    * email</span>
<span class="sd">    * first_name</span>
<span class="sd">    * gender</span>
<span class="sd">    * last_name</span>
<span class="sd">    * locale</span>
<span class="sd">    * nickname</span>
<span class="sd">    * phone</span>
<span class="sd">    * postal_code</span>
<span class="sd">    * timezone</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">supported_user_attributes</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">SupportedUserAttributes</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">link</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">picture</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
    
    <span class="n">supports_csrf_protection</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">_x_use_authorization_header</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://bitly.com/oauth/authorize&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://api-ssl.bitly.com/oauth/access_token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://api-ssl.bitly.com/v3/user/info&#39;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Bitly</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offline</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;grant_type&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">access_token_params</span><span class="p">[</span><span class="s">&#39;grant_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;refresh_token&#39;</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;data&#39;</span><span class="p">,</span> <span class="p">{})</span>
        
        <span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;login&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;full_name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;display_name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;profile_image&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;profile_url&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">user</span>

</div>
<div class="viewcode-block" id="Cosm"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.Cosm">[docs]</a><span class="k">class</span> <span class="nc">Cosm</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cosm |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        Cosm doesn&#39;t provide any *user info URL*.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: https://cosm.com/users/{your_username}/apps</span>
<span class="sd">    * Docs: https://cosm.com/docs/</span>
<span class="sd">    * API reference: https://cosm.com/docs/v2/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://cosm.com/oauth/authenticate&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://cosm.com/oauth/token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>

</div>
<div class="viewcode-block" id="DeviantART"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.DeviantART">[docs]</a><span class="k">class</span> <span class="nc">DeviantART</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DeviantART |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: https://www.deviantart.com/settings/myapps</span>
<span class="sd">    * Docs: https://www.deviantart.com/developers/authentication</span>
<span class="sd">    * API reference: http://www.deviantart.com/developers/oauth2</span>

<span class="sd">    Supported :class:`.User` properties:</span>

<span class="sd">    * name</span>
<span class="sd">    * picture</span>
<span class="sd">    * username</span>

<span class="sd">    Unsupported :class:`.User` properties:</span>

<span class="sd">    * birth_date</span>
<span class="sd">    * city</span>
<span class="sd">    * country</span>
<span class="sd">    * email</span>
<span class="sd">    * first_name</span>
<span class="sd">    * gender</span>
<span class="sd">    * id</span>
<span class="sd">    * last_name</span>
<span class="sd">    * link</span>
<span class="sd">    * locale</span>
<span class="sd">    * nickname</span>
<span class="sd">    * phone</span>
<span class="sd">    * postal_code</span>
<span class="sd">    * timezone</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://www.deviantart.com/oauth2/draft15/authorize&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://www.deviantart.com/oauth2/draft15/token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://www.deviantart.com/api/oauth2/user/whoami&#39;</span>

    <span class="n">user_info_scope</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;basic&#39;</span><span class="p">]</span>

    <span class="n">supported_user_attributes</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">SupportedUserAttributes</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">picture</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">DeviantART</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offline</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;grant_type&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_token_params</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">access_token_params</span><span class="p">[</span><span class="s">&#39;grant_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;refresh_token&#39;</span>
    
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;usericonurl&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>

</div>
<div class="viewcode-block" id="Facebook"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.Facebook">[docs]</a><span class="k">class</span> <span class="nc">Facebook</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Facebook |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: https://developers.facebook.com/apps</span>
<span class="sd">    * Docs: http://developers.facebook.com/docs/howtos/login/server-side-login/</span>
<span class="sd">    * API reference: http://developers.facebook.com/docs/reference/api/</span>
<span class="sd">    * API explorer: http://developers.facebook.com/tools/explorer</span>

<span class="sd">    Supported :class:`.User` properties:</span>

<span class="sd">    * city</span>
<span class="sd">    * country</span>
<span class="sd">    * email</span>
<span class="sd">    * first_name</span>
<span class="sd">    * gender</span>
<span class="sd">    * id</span>
<span class="sd">    * last_name</span>
<span class="sd">    * link</span>
<span class="sd">    * locale</span>
<span class="sd">    * name</span>
<span class="sd">    * picture</span>
<span class="sd">    * timezone</span>
<span class="sd">    * username</span>

<span class="sd">    Unsupported :class:`.User` properties:</span>

<span class="sd">    * birth_date</span>
<span class="sd">    * nickname</span>
<span class="sd">    * phone</span>
<span class="sd">    * postal_code</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://www.facebook.com/dialog/oauth&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://graph.facebook.com/oauth/access_token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://graph.facebook.com/me&#39;</span>
    <span class="n">user_info_scope</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;user_about_me&#39;</span><span class="p">,</span> <span class="s">&#39;email&#39;</span><span class="p">]</span>
    <span class="n">same_origin</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">supported_user_attributes</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">SupportedUserAttributes</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">email</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">first_name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">last_name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">city</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">country</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">gender</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">link</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">locale</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">picture</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">timezone</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_x_request_elements_filter</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">request_elements</span><span class="p">,</span> <span class="n">credentials</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">cls</span><span class="o">.</span><span class="n">REFRESH_TOKEN_REQUEST_TYPE</span><span class="p">:</span>
            <span class="c"># As always, Facebook has it&#39;s original name for &quot;refresh_token&quot;!</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">request_elements</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;fb_exchange_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;refresh_token&#39;</span><span class="p">)</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;grant_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;fb_exchange_token&#39;</span>
            <span class="n">request_elements</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">RequestElements</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">request_elements</span>
    
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Facebook</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c"># Handle special Facebook requirements to be able to refresh the access token.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offline</span><span class="p">:</span>
            <span class="c"># Facebook needs an offline_access scope.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;offline_access&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;offline_access&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">popup</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_url</span> <span class="o">+=</span> <span class="s">&#39;?display=popup&#39;</span>
    
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="s">&#39;http://graph.facebook.com/{0}/picture?type=large&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">))</span>

        <span class="n">location</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">and</span> <span class="n">location</span><span class="o">.</span><span class="n">split</span><span class="p">:</span>
            <span class="n">split_location</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
            <span class="n">user</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">split_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_location</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">user</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">split_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">user</span>
    
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_credentials_parser</span><span class="p">(</span><span class="n">credentials</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        We need to override this method to fix Facebooks naming deviation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># Facebook returns &quot;expires&quot; instead of &quot;expires_in&quot;.</span>
        <span class="n">credentials</span><span class="o">.</span><span class="n">expire_in</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;expires&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">credentials</span>
    
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_refresh_credentials_if</span><span class="p">(</span><span class="n">credentials</span><span class="p">):</span>
        <span class="c"># Always refresh.</span>
        <span class="k">return</span> <span class="bp">True</span>

</div>
<div class="viewcode-block" id="Foursquare"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.Foursquare">[docs]</a><span class="k">class</span> <span class="nc">Foursquare</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Foursquare |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: https://foursquare.com/developers/apps</span>
<span class="sd">    * Docs: https://developer.foursquare.com/overview/auth.html</span>
<span class="sd">    * API reference: https://developer.foursquare.com/docs/</span>

<span class="sd">    .. note::</span>

<span class="sd">        Foursquare requires a *version* parameter in each request.</span>
<span class="sd">        The default value is ``v=20140501``. You can override the version in</span>
<span class="sd">        the ``params`` parameter of the :meth:`.Authomatic.access` method.</span>
<span class="sd">        See https://developer.foursquare.com/overview/versioning</span>

<span class="sd">    Supported :class:`.User` properties:</span>

<span class="sd">    * city</span>
<span class="sd">    * country</span>
<span class="sd">    * email</span>
<span class="sd">    * first_name</span>
<span class="sd">    * gender</span>
<span class="sd">    * id</span>
<span class="sd">    * last_name</span>
<span class="sd">    * name</span>
<span class="sd">    * phone</span>
<span class="sd">    * picture</span>

<span class="sd">    Unsupported :class:`.User` properties:</span>

<span class="sd">    * birth_date</span>
<span class="sd">    * link</span>
<span class="sd">    * locale</span>
<span class="sd">    * nickname</span>
<span class="sd">    * postal_code</span>
<span class="sd">    * timezone</span>
<span class="sd">    * username</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://foursquare.com/oauth2/authenticate&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://foursquare.com/oauth2/access_token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://api.foursquare.com/v2/users/self&#39;</span>
    
    <span class="n">same_origin</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">supported_user_attributes</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">SupportedUserAttributes</span><span class="p">(</span>
        <span class="n">city</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">country</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">email</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">first_name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">gender</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">last_name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">phone</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">picture</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_x_request_elements_filter</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">request_elements</span><span class="p">,</span>
                                   <span class="n">credentials</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">cls</span><span class="o">.</span><span class="n">PROTECTED_RESOURCE_REQUEST_TYPE</span><span class="p">:</span>
            <span class="c"># Foursquare uses OAuth 1.0 &quot;oauth_token&quot; for what should be</span>
            <span class="c"># &quot;access_token&quot; in OAuth 2.0!</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">request_elements</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;oauth_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;access_token&#39;</span><span class="p">)</span>

            <span class="c"># Foursquare needs the version &quot;v&quot; parameter in every request.</span>
            <span class="c"># https://developer.foursquare.com/overview/versioning</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;v&#39;</span><span class="p">):</span>
                <span class="n">params</span><span class="p">[</span><span class="s">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;20140501&#39;</span>

            <span class="n">request_elements</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">RequestElements</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span>
                                                    <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">request_elements</span>
    
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        
        <span class="n">_resp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;response&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">_user</span> <span class="o">=</span> <span class="n">_resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="p">{})</span>
        
        <span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;firstName&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;lastName&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">gender</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;gender&#39;</span><span class="p">)</span>

        <span class="n">_photo</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;photo&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_photo</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">_photo_prefix</span> <span class="o">=</span> <span class="n">_photo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;prefix&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">_photo_suffix</span> <span class="o">=</span> <span class="n">_photo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;suffix&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
            <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">_photo_prefix</span><span class="p">,</span> <span class="n">_photo_suffix</span><span class="p">])</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_photo</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">_photo</span>
        
        <span class="n">user</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;homeCity&#39;</span><span class="p">,</span> <span class="s">&#39;, &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;, &#39;</span><span class="p">)</span>
        
        <span class="n">_contact</span> <span class="o">=</span> <span class="n">_user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;contact&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">_contact</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;email&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">phone</span> <span class="o">=</span> <span class="n">_contact</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;phone&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">user</span>

</div>
<div class="viewcode-block" id="GitHub"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.GitHub">[docs]</a><span class="k">class</span> <span class="nc">GitHub</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    GitHub |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: https://github.com/settings/applications/</span>
<span class="sd">    * Docs: http://developer.github.com/v3/#authentication</span>
<span class="sd">    * API reference: http://developer.github.com/v3/</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        GitHub API `documentation &lt;http://developer.github.com/v3/#user-agent-required&gt;`_ sais:</span>
<span class="sd">        </span>
<span class="sd">            all API requests MUST include a valid ``User-Agent`` header.</span>
<span class="sd">        </span>
<span class="sd">        You can apply a default ``User-Agent`` header for all API calls in the config like this:</span>
<span class="sd">        </span>
<span class="sd">        .. code-block:: python</span>
<span class="sd">            :emphasize-lines: 6</span>
<span class="sd">        </span>
<span class="sd">            CONFIG = {</span>
<span class="sd">                &#39;github&#39;: {</span>
<span class="sd">                    &#39;class_&#39;: oauth2.GitHub,</span>
<span class="sd">                    &#39;consumer_key&#39;: &#39;#####&#39;,</span>
<span class="sd">                    &#39;consumer_secret&#39;: &#39;#####&#39;,</span>
<span class="sd">                    &#39;access_headers&#39;: {&#39;User-Agent&#39;: &#39;Awesome-Octocat-App&#39;},</span>
<span class="sd">                }</span>
<span class="sd">            }</span>

<span class="sd">    * city</span>
<span class="sd">    * country</span>
<span class="sd">    * email</span>
<span class="sd">    * id</span>
<span class="sd">    * link</span>
<span class="sd">    * name</span>
<span class="sd">    * picture</span>
<span class="sd">    * username</span>

<span class="sd">    Unsupported :class:`.User` properties:</span>

<span class="sd">    * birth_date</span>
<span class="sd">    * first_name</span>
<span class="sd">    * gender</span>
<span class="sd">    * last_name</span>
<span class="sd">    * locale</span>
<span class="sd">    * nickname</span>
<span class="sd">    * phone</span>
<span class="sd">    * postal_code</span>
<span class="sd">    * timezone</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://github.com/login/oauth/authorize&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://github.com/login/oauth/access_token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://api.github.com/user&#39;</span>
    
    <span class="n">same_origin</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">supported_user_attributes</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">SupportedUserAttributes</span><span class="p">(</span>
        <span class="n">city</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">country</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">email</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">link</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">picture</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;login&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;avatar_url&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;html_url&#39;</span><span class="p">)</span>

        <span class="n">location</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">location</span><span class="p">:</span>
            <span class="n">split_location</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">user</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">split_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_location</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">user</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">split_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            
        <span class="k">return</span> <span class="n">user</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_x_credentials_parser</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;token_type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;bearer&#39;</span><span class="p">:</span>
            <span class="n">credentials</span><span class="o">.</span><span class="n">token_type</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">BEARER</span>
        <span class="k">return</span> <span class="n">credentials</span>

</div>
<div class="viewcode-block" id="Google"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.Google">[docs]</a><span class="k">class</span> <span class="nc">Google</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Google |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: https://console.developers.google.com/project</span>
<span class="sd">    * Docs: https://developers.google.com/accounts/docs/OAuth2</span>
<span class="sd">    * API reference: https://developers.google.com/gdata/docs/directory</span>
<span class="sd">    * API explorer: https://developers.google.com/oauthplayground/</span>

<span class="sd">    Supported :class:`.User` properties:</span>

<span class="sd">    * email</span>
<span class="sd">    * first_name</span>
<span class="sd">    * gender</span>
<span class="sd">    * id</span>
<span class="sd">    * last_name</span>
<span class="sd">    * link</span>
<span class="sd">    * locale</span>
<span class="sd">    * name</span>
<span class="sd">    * picture</span>

<span class="sd">    Unsupported :class:`.User` properties:</span>

<span class="sd">    * birth_date</span>
<span class="sd">    * city</span>
<span class="sd">    * country</span>
<span class="sd">    * nickname</span>
<span class="sd">    * phone</span>
<span class="sd">    * postal_code</span>
<span class="sd">    * timezone</span>
<span class="sd">    * username</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://accounts.google.com/o/oauth2/auth&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://accounts.google.com/o/oauth2/token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://www.googleapis.com/plus/v1/people/me&#39;</span>

    <span class="n">user_info_scope</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;profile&#39;</span><span class="p">,</span>
                       <span class="s">&#39;email&#39;</span><span class="p">]</span>

    <span class="n">supported_user_attributes</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">SupportedUserAttributes</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">email</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">first_name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">last_name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">gender</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">locale</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">link</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">picture</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Google</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c"># Handle special Google requirements to be able to refresh the access token.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offline</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;access_type&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_params</span><span class="p">:</span>
                <span class="c"># Google needs access_type=offline param in the user authorization request.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_params</span><span class="p">[</span><span class="s">&#39;access_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;offline&#39;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;approval_prompt&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_params</span><span class="p">:</span>
                <span class="c"># And also approval_prompt=force.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_params</span><span class="p">[</span><span class="s">&#39;approval_prompt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;force&#39;</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">emails</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;emails&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">emails</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">emails</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">email</span> <span class="ow">in</span> <span class="n">emails</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">email</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;account&#39;</span><span class="p">:</span>
                    <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;value&#39;</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sub&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;displayName&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;givenName&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;familyName&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;language&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;url&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;image&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;url&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">birth_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;birthdate&#39;</span><span class="p">),</span> <span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">birth_date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;birthdate&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>
    
    <span class="k">def</span> <span class="nf">_x_scope_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scope</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Google has space-separated scopes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="LinkedIn"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.LinkedIn">[docs]</a><span class="k">class</span> <span class="nc">LinkedIn</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Linked In |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        Doesn&#39;t support access token refreshment.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: https://www.linkedin.com/secure/developer</span>
<span class="sd">    * Docs: http://developer.linkedin.com/documents/authentication</span>
<span class="sd">    * API reference: http://developer.linkedin.com/rest</span>

<span class="sd">    Supported :class:`.User` properties:</span>

<span class="sd">    * birth_date</span>
<span class="sd">    * country</span>
<span class="sd">    * email</span>
<span class="sd">    * first_name</span>
<span class="sd">    * id</span>
<span class="sd">    * last_name</span>
<span class="sd">    * link</span>
<span class="sd">    * name</span>
<span class="sd">    * phone</span>
<span class="sd">    * picture</span>

<span class="sd">    Unsupported :class:`.User` properties:</span>

<span class="sd">    * city</span>
<span class="sd">    * gender</span>
<span class="sd">    * locale</span>
<span class="sd">    * nickname</span>
<span class="sd">    * postal_code</span>
<span class="sd">    * timezone</span>
<span class="sd">    * username</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://www.linkedin.com/uas/oauth2/authorization&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://www.linkedin.com/uas/oauth2/accessToken&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://api.linkedin.com/v1/people/~:&#39;</span> <span class="o">+</span> \
                    <span class="s">&#39;(id,first-name,last-name,formatted-name,location,picture-url,public-profile-url,email-address,date-of-birth,phone-numbers)?format=json&#39;</span>
    
    <span class="n">user_info_scope</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;r_fullprofile&#39;</span><span class="p">,</span> <span class="s">&#39;r_emailaddress&#39;</span><span class="p">,</span> <span class="s">&#39;r_contactinfo&#39;</span><span class="p">]</span>
    
    <span class="n">token_request_method</span> <span class="o">=</span> <span class="s">&#39;GET&#39;</span>  <span class="c"># To avoid a bug with OAuth2.0 on Linkedin</span>
    <span class="c"># http://developer.linkedin.com/forum/unauthorized-invalid-or-expired-token-immediately-after-receiving-oauth2-token</span>

    <span class="n">supported_user_attributes</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">SupportedUserAttributes</span><span class="p">(</span>
        <span class="n">birth_date</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">country</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">email</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">first_name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">last_name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">link</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">phone</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">picture</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_x_request_elements_filter</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">request_elements</span><span class="p">,</span> <span class="n">credentials</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">cls</span><span class="o">.</span><span class="n">PROTECTED_RESOURCE_REQUEST_TYPE</span><span class="p">:</span>
            <span class="c"># LinkedIn too has it&#39;s own terminology!</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">request_elements</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;oauth2_access_token&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;access_token&#39;</span><span class="p">)</span>
            <span class="n">request_elements</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">RequestElements</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">request_elements</span>
    
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        
        <span class="n">user</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;firstName&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;lastName&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;emailAddress&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;formattedName&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">phone</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;phoneNumbers&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;values&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;phoneNumber&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pictureUrl&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;publicProfileUrl&#39;</span><span class="p">)</span>

        <span class="n">_birthdate</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;dateOfBirth&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">_birthdate</span><span class="p">:</span>
            <span class="n">_day</span> <span class="o">=</span> <span class="n">_birthdate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;day&#39;</span><span class="p">)</span>
            <span class="n">_month</span> <span class="o">=</span> <span class="n">_birthdate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;month&#39;</span><span class="p">)</span>
            <span class="n">_year</span> <span class="o">=</span> <span class="n">_birthdate</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;year&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_day</span> <span class="ow">and</span> <span class="n">_month</span> <span class="ow">and</span> <span class="n">_year</span><span class="p">:</span>
                <span class="n">user</span><span class="o">.</span><span class="n">birth_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">_year</span><span class="p">,</span> <span class="n">_month</span><span class="p">,</span> <span class="n">_day</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">user</span>

</div>
<div class="viewcode-block" id="PayPal"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.PayPal">[docs]</a><span class="k">class</span> <span class="nc">PayPal</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PayPal |oauth2| provider.</span>

<span class="sd">    * Dashboard: https://developer.paypal.com/webapps/developer/applications</span>
<span class="sd">    * Docs: https://developer.paypal.com/webapps/developer/docs/integration/direct/make-your-first-call/</span>
<span class="sd">    * API reference: https://developer.paypal.com/webapps/developer/docs/api/</span>

<span class="sd">    .. note::</span>

<span class="sd">        Paypal doesn&#39;t redirect the **user** to authorize your app!</span>
<span class="sd">        It grants you an **access token** based on your **app&#39;s** key and</span>
<span class="sd">        secret instead.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">_x_use_authorization_header</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">supported_user_attributes</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">SupportedUserAttributes</span><span class="p">()</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_x_request_elements_filter</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">request_elements</span><span class="p">,</span> <span class="n">credentials</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">cls</span><span class="o">.</span><span class="n">ACCESS_TOKEN_REQUEST_TYPE</span><span class="p">:</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span> <span class="o">=</span> <span class="n">request_elements</span>
            <span class="n">params</span><span class="p">[</span><span class="s">&#39;grant_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;client_credentials&#39;</span>
            <span class="n">request_elements</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">RequestElements</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">body</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">request_elements</span>
    
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://api.sandbox.paypal.com/v1/oauth2/token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

</div>
<div class="viewcode-block" id="Reddit"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.Reddit">[docs]</a><span class="k">class</span> <span class="nc">Reddit</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reddit |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        Currently credentials refreshment returns ``{&quot;error&quot;: &quot;invalid_request&quot;}``.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: https://ssl.reddit.com/prefs/apps</span>
<span class="sd">    * Docs: https://github.com/reddit/reddit/wiki/OAuth2</span>
<span class="sd">    * API reference: http://www.reddit.com/dev/api</span>

<span class="sd">    Supported :class:`.User` properties:</span>

<span class="sd">    * id</span>
<span class="sd">    * username</span>

<span class="sd">    Unsupported :class:`.User` properties:</span>

<span class="sd">    * birth_date</span>
<span class="sd">    * country</span>
<span class="sd">    * city</span>
<span class="sd">    * email</span>
<span class="sd">    * first_name</span>
<span class="sd">    * gender</span>
<span class="sd">    * last_name</span>
<span class="sd">    * link</span>
<span class="sd">    * locale</span>
<span class="sd">    * name</span>
<span class="sd">    * nickname</span>
<span class="sd">    * phone</span>
<span class="sd">    * picture</span>
<span class="sd">    * postal_code</span>
<span class="sd">    * timezone</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://ssl.reddit.com/api/v1/authorize&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://ssl.reddit.com/api/v1/access_token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://oauth.reddit.com/api/v1/me.json&#39;</span>
    
    <span class="n">user_info_scope</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;identity&#39;</span><span class="p">]</span>

    <span class="n">supported_user_attributes</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">SupportedUserAttributes</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="bp">True</span>
    <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Reddit</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offline</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;duration&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_params</span><span class="p">:</span>
                <span class="c"># http://www.reddit.com/r/changelog/comments/11jab9/reddit_change_permanent_oauth_grants_using/</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_authorization_params</span><span class="p">[</span><span class="s">&#39;duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;permanent&#39;</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_x_credentials_parser</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;token_type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;bearer&#39;</span><span class="p">:</span>
            <span class="n">credentials</span><span class="o">.</span><span class="n">token_type</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">BEARER</span>
        <span class="k">return</span> <span class="n">credentials</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">user</span>

</div>
<div class="viewcode-block" id="Viadeo"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.Viadeo">[docs]</a><span class="k">class</span> <span class="nc">Viadeo</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Viadeo |oauth2| provider.</span>

<span class="sd">    .. note::</span>

<span class="sd">        As stated in the `Viadeo documentation</span>
<span class="sd">        &lt;http://dev.viadeo.com/documentation/authentication/request-an-api-key/&gt;`__:</span>

<span class="sd">            Viadeo restrains access to its API.</span>
<span class="sd">            They are now exclusively reserved for its strategic partners.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: http://dev.viadeo.com/dashboard/</span>
<span class="sd">    * Docs: http://dev.viadeo.com/documentation/authentication/oauth-authentication/</span>
<span class="sd">    * API reference: http://dev.viadeo.com/documentation/</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        Viadeo doesn&#39;t support **credentials refreshment**.</span>
<span class="sd">        As stated in their `docs &lt;http://dev.viadeo.com/documentation/authentication/oauth-authentication/&gt;`_:</span>
<span class="sd">        &quot;The access token has an infinite time to live.&quot;</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://secure.viadeo.com/oauth-provider/authorize2&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://secure.viadeo.com/oauth-provider/access_token2&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://api.viadeo.com/me&#39;</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_x_credentials_parser</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;token_type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;bearer_token&#39;</span><span class="p">:</span>
            <span class="n">credentials</span><span class="o">.</span><span class="n">token_type</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">BEARER</span>
        <span class="k">return</span> <span class="n">credentials</span>
    
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_refresh_credentials_if</span><span class="p">(</span><span class="n">credentials</span><span class="p">):</span>
        <span class="c"># Never refresh.</span>
        <span class="k">return</span> <span class="bp">False</span>
    
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;nickname&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;picture_large&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;picture_large&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">locale</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;language&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;country&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">postal_code</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;zipcode&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;timezone&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">user</span>

</div>
<div class="viewcode-block" id="VK"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.VK">[docs]</a><span class="k">class</span> <span class="nc">VK</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    VK.com |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: Could not find any. You must do it like this: http://vk.com/editapp?id={consumer_key}</span>
<span class="sd">    * Docs: http://vk.com/developers.php?oid=-17680044&amp;p=Authorizing_Sites</span>
<span class="sd">    * API reference: http://vk.com/developers.php?oid=-17680044&amp;p=API_Method_Description</span>
<span class="sd">    </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        VK uses a `bitmask scope &lt;http://vk.com/developers.php?oid=-17680044&amp;p=Application_Rights&gt;`_!</span>
<span class="sd">        Use it like this:</span>
<span class="sd">        </span>
<span class="sd">    .. code-block:: python</span>
<span class="sd">        :emphasize-lines: 7</span>
<span class="sd">        </span>
<span class="sd">        CONFIG = {</span>
<span class="sd">            &#39;vk&#39;: {</span>
<span class="sd">                &#39;class_&#39;: oauth2.VK,</span>
<span class="sd">                &#39;consumer_key&#39;: &#39;#####&#39;,</span>
<span class="sd">                &#39;consumer_secret&#39;: &#39;#####&#39;,</span>
<span class="sd">                &#39;id&#39;: authomatic.provider_id(),</span>
<span class="sd">                &#39;scope&#39;: [&#39;1024&#39;] # Always a single item.</span>
<span class="sd">            }</span>
<span class="sd">        }</span>

<span class="sd">    Supported :class:`.User` properties:</span>

<span class="sd">    * birth_date</span>
<span class="sd">    * city</span>
<span class="sd">    * country</span>
<span class="sd">    * first_name</span>
<span class="sd">    * gender</span>
<span class="sd">    * id</span>
<span class="sd">    * last_name</span>
<span class="sd">    * name</span>
<span class="sd">    * picture</span>
<span class="sd">    * timezone</span>

<span class="sd">    Unsupported :class:`.User` properties:</span>

<span class="sd">    * email</span>
<span class="sd">    * link</span>
<span class="sd">    * locale</span>
<span class="sd">    * nickname</span>
<span class="sd">    * phone</span>
<span class="sd">    * postal_code</span>
<span class="sd">    * username</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;http://api.vkontakte.ru/oauth/authorize&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://api.vkontakte.ru/oauth/access_token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://api.vk.com/method/getProfiles?&#39;</span> <span class="o">+</span> \
                    <span class="s">&#39;fields=uid,first_name,last_name,nickname,sex,bdate,city,country,timezone,photo_big&#39;</span>

    <span class="n">supported_user_attributes</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">SupportedUserAttributes</span><span class="p">(</span>
        <span class="n">birth_date</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">city</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">country</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">first_name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">gender</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="nb">id</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">last_name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">picture</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">timezone</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">VK</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offline</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;offline&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;offline&#39;</span><span class="p">)</span>
    
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">_resp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;response&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">_birth_date</span> <span class="o">=</span> <span class="n">_resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;bdate&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_birth_date</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">birth_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">_birth_date</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">.%m.%Y&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">_resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;uid&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">first_name</span> <span class="o">=</span> <span class="n">_resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;first_name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">gender</span> <span class="o">=</span> <span class="n">_resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sex&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="n">_resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;last_name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">nickname</span> <span class="o">=</span> <span class="n">_resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;nickname&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">_resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;city&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">_resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;country&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">timezone</span> <span class="o">=</span> <span class="n">_resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;timezone&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">_resp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;photo_big&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">user</span>

</div>
<div class="viewcode-block" id="WindowsLive"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.WindowsLive">[docs]</a><span class="k">class</span> <span class="nc">WindowsLive</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Windows Live |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: https://manage.dev.live.com/Applications/Index</span>
<span class="sd">    * Docs: http://msdn.microsoft.com/en-us/library/live/hh826528.aspx</span>
<span class="sd">    * API explorer: http://isdk.dev.live.com/?mkt=en-us</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://oauth.live.com/authorize&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://oauth.live.com/token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://apis.live.net/v5.0/me&#39;</span>
    
    <span class="n">user_info_scope</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;wl.basic&#39;</span><span class="p">,</span> <span class="s">&#39;wl.emails&#39;</span><span class="p">,</span> <span class="s">&#39;wl.photos&#39;</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WindowsLive</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offline</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;wl.offline_access&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scope</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;wl.offline_access&#39;</span><span class="p">)</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_x_credentials_parser</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;token_type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;bearer&#39;</span><span class="p">:</span>
            <span class="n">credentials</span><span class="o">.</span><span class="n">token_type</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">BEARER</span>
        <span class="k">return</span> <span class="n">credentials</span>
    
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;emails&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;preferred&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="s">&#39;https://apis.live.net/v5.0/{0}/picture&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">user</span>

</div>
<div class="viewcode-block" id="Yammer"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.Yammer">[docs]</a><span class="k">class</span> <span class="nc">Yammer</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yammer |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    .. warning::</span>
<span class="sd">        </span>
<span class="sd">        |no-csrf|</span>

<span class="sd">    * Dashboard: https://www.yammer.com/client_applications</span>
<span class="sd">    * Docs: https://developer.yammer.com/authentication/</span>
<span class="sd">    * API reference: https://developer.yammer.com/restapi/</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://www.yammer.com/dialog/oauth&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://www.yammer.com/oauth2/access_token.json&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://www.yammer.com/api/v1/users/current.json&#39;</span>
    
    <span class="n">supports_csrf_protection</span> <span class="o">=</span> <span class="bp">False</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_x_credentials_parser</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        
        <span class="n">_access_token</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;access_token&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">credentials</span><span class="o">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">_access_token</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;token&#39;</span><span class="p">)</span>
        <span class="n">_expire_in</span> <span class="o">=</span> <span class="n">_access_token</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;expires_at&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_expire_in</span><span class="p">:</span>
            <span class="n">credentials</span><span class="o">.</span><span class="n">expire_in</span> <span class="o">=</span> <span class="n">_expire_in</span>
        
        <span class="k">return</span> <span class="n">credentials</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        
        <span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;full_name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;web_url&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">picture</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;mugshot_url&#39;</span><span class="p">)</span>
        
        <span class="n">user</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;location&#39;</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">user</span><span class="o">.</span><span class="n">country</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">country</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        
        <span class="c"># Contact</span>
        <span class="n">_contact</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;contact&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">user</span><span class="o">.</span><span class="n">phone</span> <span class="o">=</span> <span class="n">_contact</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;phone_numbers&#39;</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;number&#39;</span><span class="p">)</span>
        <span class="n">_emails</span> <span class="o">=</span> <span class="n">_contact</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;email_addresses&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">email</span> <span class="ow">in</span> <span class="n">_emails</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">email</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;primary&#39;</span><span class="p">:</span>
                <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;address&#39;</span><span class="p">)</span>
                <span class="k">break</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">birth_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;birth_date&#39;</span><span class="p">),</span> <span class="s">&quot;%B </span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">birth_date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;birth_date&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">user</span>

</div>
<div class="viewcode-block" id="Yandex"><a class="viewcode-back" href="../../../reference/providers.html#authomatic.providers.oauth2.Yandex">[docs]</a><span class="k">class</span> <span class="nc">Yandex</span><span class="p">(</span><span class="n">OAuth2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yandex |oauth2| provider.</span>
<span class="sd">    </span>
<span class="sd">    * Dashboard: https://oauth.yandex.com/client/my</span>
<span class="sd">    * Docs: http://api.yandex.com/oauth/doc/dg/reference/obtain-access-token.xml</span>
<span class="sd">    * API reference: </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">user_authorization_url</span> <span class="o">=</span> <span class="s">&#39;https://oauth.yandex.com/authorize&#39;</span>
    <span class="n">access_token_url</span> <span class="o">=</span> <span class="s">&#39;https://oauth.yandex.com/token&#39;</span>
    <span class="n">user_info_url</span> <span class="o">=</span> <span class="s">&#39;https://login.yandex.ru/info&#39;</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_x_credentials_parser</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;token_type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;bearer&#39;</span><span class="p">:</span>
            <span class="n">credentials</span><span class="o">.</span><span class="n">token_type</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">BEARER</span>
        <span class="k">return</span> <span class="n">credentials</span>
    
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_x_user_parser</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        
        <span class="c"># http://api.yandex.ru/login/doc/dg/reference/response.xml</span>
        <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;real_name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">nickname</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;display_name&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">gender</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Sex&#39;</span><span class="p">)</span>
        <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Default_email&#39;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">birth_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;birthday&#39;</span><span class="p">),</span> <span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">birth_date</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;birthday&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">user</span>


<span class="c"># The provider type ID is generated from this list&#39;s indexes!</span>
<span class="c"># Always append new providers at the end so that ids of existing providers don&#39;t change!</span></div>
<span class="n">PROVIDER_ID_MAP</span> <span class="o">=</span> <span class="p">[</span><span class="n">OAuth2</span><span class="p">,</span> <span class="n">Behance</span><span class="p">,</span> <span class="n">Bitly</span><span class="p">,</span> <span class="n">Cosm</span><span class="p">,</span> <span class="n">DeviantART</span><span class="p">,</span> <span class="n">Facebook</span><span class="p">,</span> <span class="n">Foursquare</span><span class="p">,</span> <span class="n">GitHub</span><span class="p">,</span> <span class="n">Google</span><span class="p">,</span> <span class="n">LinkedIn</span><span class="p">,</span>
          <span class="n">PayPal</span><span class="p">,</span> <span class="n">Reddit</span><span class="p">,</span> <span class="n">Viadeo</span><span class="p">,</span> <span class="n">VK</span><span class="p">,</span> <span class="n">WindowsLive</span><span class="p">,</span> <span class="n">Yammer</span><span class="p">,</span> <span class="n">Yandex</span><span class="p">]</span>
</pre></div>

			</div>
			
			
			
			<div id="navigation" class="large-3 pull-9 columns">
				<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/config.html">Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/adapters.html">Adapters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/adapters.html#available-adapters">Available Adapters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/adapters.html#implementing-an-adapter">Implementing an Adapter</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/functions.html">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/classes.html">Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/providers.html">Providers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/providers.html#oauth2-providers">OAuth 2.0 Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/providers.html#oauth1-providers">OAuth 1.0a Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/providers.html#openid-providers">OpenID Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/providers.html#google-app-engine-openid-providers">Google App Engine OpenID Providers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/providers.html#abstract-classes-for-providers">Abstract Classes for Providers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/extras.html">Extras</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extras.html#flask-extras">Flask Extras</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extras.html#gae-extras">Google App Engine Extras</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/extras.html#interfaces">Interfaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../reference/javascript.html">JavaScript</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/index.html">Tutorials / Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/django-simple.html">Simple Django Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/flask-simple.html">Simple Flask Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/pyramid-simple.html">Simple Pyramid Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/simple.html">Simple Webapp2 Google App Engine Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../examples/credentials.html">Advanced Webapp2 Google App Engine Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../development.html">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../development.html#development-environment-setup">Development Environment Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development.html#documentation-compilation-and-deployment">Documentation Compilation and Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../development.html#tests">Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-0-0-9-development">Version 0.0.9 (development)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-0-0-8">Version 0.0.8</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-0-0-7">Version 0.0.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../changelog.html#version-0-0-6">Version 0.0.6</a></li>
</ul>
</li>
</ul>

			</div>
			
		</div>
		
		<div id="root_footer"></div>
	</div><div id="footer"><div id="bottom-nav"><span><a href="../../../genindex.html"  title="General Index">index</a></span>
				<span><a href="../../../py-modindex.html"  title="Python Module Index">modules</a></span>
				</div><div id="footer-notice">
			    	&copy; Copyright 2014,
			    	
			    		<a href="http://peterhudec.com">Peter Hudec</a>
			    		<a class="google-plus-badge" href="//plus.google.com/117034840853387702598?rel=author" rel="author" style="text-decoration:none;">
						<img src="//ssl.gstatic.com/images/icons/gplus-16.png" alt="Google+"/></a>.
		        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
	    </div></div><script>
		document.write('<script src=' +
		('__proto__' in {} ? '../../../_static/foundation/js/vendor/zepto' : 'js/vendor/jquery') +
		'.js><\/script>')
	</script>
	<script src="../../../_static/foundation/js/foundation.min.js"></script>
	<script src="../../../_static/foundation/js/foundation/foundation.topbar.js"></script>
	<script>
		$(document).foundation();
		
		/**
		 * Fallback svg to png.
		 * Taken from Todd Motto's article:
		 * http://toddmotto.com/mastering-svg-use-for-a-retina-web-fallbacks-with-png-script/
		 */
		if(!Modernizr.svg) {
		    $('img[src*="svg"]').attr('src', function() {
		        return $(this).attr('src').replace('.svg', '.png');
		    });
		}
		
		// Reset width of all table columns.
		$('col').attr('width', null);
		
		// Add "returns" class to all returns elements
		$(".field-name:contains('Returns:')").parent().addClass('returns');
		
		
		(function() {
		    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
		    po.src = 'https://apis.google.com/js/plusone.js';
		    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
		})();
		
		
		
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-40554445-4']);
		_gaq.push(['_trackPageview']);
		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
		
	</script>
	
		<a	id="github-ribbon"
			style="right: 0; border: 0;"
			href="https://github.com/peterhudec/authomatic">
			<img
				 src="../../../_static/img/github-ribbon-right.png"
				 alt="Fork me on GitHub">
		</a>
	
</body>

</html>